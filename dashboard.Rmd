---
title: "Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source: embed
---

```{r setup, include=FALSE}
library(flexdashboard)
library(p8105.datasets)
library(tidyverse)
library(plotly)
library(viridis)
theme_set(theme_minimal())
```

```{r}
data("ny_noaa")

# Separate date and join with month dataframe

noaa_df = 
  ny_noaa %>% 
  separate(date, into = c("year", "month", "day"), sep = "-") %>%
  mutate(tmax = as.numeric(tmax)/10,
         tmin = as.numeric(tmin)/10,
         year = as.factor(year),
         month = as.integer(month),
         day = as.integer(day)
         ) 

# Create a table to assign corresponding month names to the month numbers. 
month_df = 
  tibble(
    month = 1:12,
    month_name = month.name
  )

# Add month names 
noaa_df = 
  left_join(noaa_df, month_df, by = "month")

# Filter only for year 2010 so that graphs are more informative
noaa_df =
  noaa_df %>% 
  drop_na() %>%
  relocate("id", "month_name", "day", "year") %>%
  filter(year == 2010)
```


```

Column {data-width=650}
-----------------------------------------------------------------------

### Snowfall by Month in 2010

```{r}
noaa_df %>% 
  filter(snow != 0) %>%
  mutate(text_label = str_c("Snow Depth: ", snwd, "mm")) %>%
  mutate(month_name = fct_reorder(month_name, month)) %>%
  plot_ly(
  x = ~month_name, y = ~snow, color = ~month_name, 
  colors = "viridis", type = "box", text = ~text_label) %>%
  layout(xaxis = list(title = "Month"), yaxis = list(title = "Snowfall (mm)"))
```

Column {data-width=350}
-----------------------------------------------------------------------

### Snowfall and Snow depth in 2010

```{r}
noaa_df %>% 
  filter(snow != 0) %>%
  mutate(
  snow = log10(snow),
  snowfall = log10(snwd),
  month_name = fct_reorder(month_name, month)
  ) %>%
  plot_ly(
  x = ~snow, y = ~snwd, color = ~month_name, 
  colors = "viridis", type = "scatter", alpha = .5,
  mode = "markers", text = ~month_name) %>%
  layout(xaxis = list(title = "Log of Snowfall (mm))"), yaxis = list(title = "Log of Snow depth (mm)"))
```

### Maximum and Minimum Temperatures in 2010 at Station USC00300023

```{r}
# Line graph for one station showing minimum and maximum temperatures
noaa_df %>%
  unite("date", day:month, sep = "-") %>% 
  mutate(date = as.Date(date, format = "%d-%Y-%m")) %>%
  filter(id == "USC00300023") %>%
  mutate(text_label = str_c("Precipitation: ", prcp, " tenths of mm")) %>%
  plot_ly(x = ~date) %>%
  add_trace(y = ~tmin, name = "tmin",
  type = "scatter", mode = "lines",
  text = ~text_label) %>%
  add_trace(y = ~tmax, name = "tmax", mode = 'lines',
  text = ~text_label) %>%
  layout(xaxis = list(title = "Date"), yaxis = list(title = "Maximum and Minimum Temperature (C)"))
```

